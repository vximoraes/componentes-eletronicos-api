# Plano de Teste para Model (Sprint 7)

| Funcionalidade                        | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|---------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Cadastro de orçamento                 | Só pode ser cadastrado com nome, protocolo único, valor, e pelo menos um componente válido | Tentar salvar orçamento sem campos obrigatórios ou com protocolo já existente | Deve falhar com erro de validação (`required`) ou de unicidade (`unique`)                          |
| Cadastro válido                       | Orçamento com todos os campos obrigatórios e válidos deve ser salvo com sucesso        | Inserir orçamento com todos os campos preenchidos corretamente       | O orçamento é salvo e retornado com `_id`, `protocolo` único e valor calculado                      |
| Valor calculado                       | O campo `valor` deve ser a soma dos subtotais dos componentes                          | Cadastrar orçamento com múltiplos componentes                       | O campo `valor` corresponde à soma dos subtotais                                                    |
| Protocolo único                       | Não deve permitir cadastro com protocolo já existente                                  | Enviar requisição com protocolo já cadastrado                       | Deve retornar erro 400 para protocolo já cadastrado                                                 |
| Leitura de orçamentos                 | O sistema deve retornar todos os orçamentos cadastrados                                | Fazer find() e verificar leitura dos dados inseridos                | A resposta contém um array com os orçamentos cadastrados                                            |
| Leitura por id                        | Deve retornar orçamento específico pelo id                                             | Buscar orçamento por id                                             | Retorna orçamento correto ou erro 404 se não existir                                                |
| Atualização de orçamento              | Deve ser possível atualizar informações válidas de um orçamento                        | Fazer updateOne() / findByIdAndUpdate()                            | O orçamento reflete os dados alterados                                                              |
| Remoção de orçamento                  | Um orçamento existente pode ser removido do sistema                                    | Fazer deleteOne() / findByIdAndDelete()                            | O orçamento é removido e não aparece mais na listagem                                               |
| Manipulação de componentes            | Deve ser possível adicionar, atualizar e remover componentes do orçamento              | Adicionar, atualizar, remover componente em orçamento               | O orçamento reflete corretamente as alterações nos componentes e recalcula o valor                   |
| Proibição de componente inexistente   | Não deve ser possível manipular componente inexistente                                 | Atualizar/remover componente inexistente                            | Deve retornar erro 404 para componente não encontrado                                               |
| Validação de schema                   | Deve validar o schema de entrada (campos obrigatórios)                                 | Enviar requisição com dados inválidos                               | Deve retornar erro 400 para dados inválidos                                                         |
| Resposta limpa                        | Não deve retornar campos desnecessários nas respostas                                  | Cadastrar, listar, atualizar orçamento                             | A resposta não contém campos sensíveis ou desnecessários                                            |
| Mensagens padronizadas                | Mensagens de sucesso e erro devem ser claras e padronizadas                            | Realizar operações de sucesso e erro                                | Mensagens seguem o padrão definido                                                                  |
| Erro inesperado                       | Deve retornar erro 500 para falhas inesperadas                                         | Simular erro inesperado em qualquer operação                       | Deve retornar erro 500 e mensagem padronizada                                                      |

# Plano de Teste Controller (Sprint 7)

| Funcionalidade                        | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|---------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Validação de schema                   | Deve validar o schema de entrada (campos obrigatórios)                                | Enviar requisição com dados inválidos                               | Deve retornar erro 400 para dados inválidos                                                         |
| Protocolo já cadastrado               | Não deve permitir cadastro com protocolo já existente                                 | Enviar requisição com protocolo já cadastrado                       | Deve retornar erro 400 para protocolo já cadastrado                                                 |
| Orçamento não encontrado              | Deve retornar erro ao buscar, atualizar ou deletar orçamento inexistente              | Buscar, atualizar ou deletar orçamento inexistente                  | Deve retornar erro 404 para orçamento não encontrado                                                |
| Resposta limpa                        | Não deve retornar campos desnecessários nas respostas                                 | Cadastrar, listar, atualizar orçamento                             | A resposta não contém campos sensíveis ou desnecessários                                            |
| Mensagens padronizadas                | Mensagens de sucesso e erro devem ser claras e padronizadas                           | Realizar operações de sucesso e erro                                | Mensagens seguem o padrão definido                                                                  |
| Dados inválidos no cadastro           | Deve retornar erro 400 ao tentar cadastrar orçamento com dados ausentes ou inválidos   | Enviar requisição sem campos obrigatórios                           | Deve retornar erro 400 para dados inválidos                                                         |
| Manipulação de componentes inválida   | Deve retornar erro ao tentar manipular componente inexistente                         | Atualizar/remover componente inexistente                            | Deve retornar erro 404 para componente não encontrado                                               |
| Falha inesperada                      | Deve retornar erro 500 para falhas inesperadas no controller                          | Simular erro inesperado em qualquer operação                        | Deve retornar erro 500 e mensagem padronizada                                                       |

# Plano de Teste Service (Sprint 7)

| Funcionalidade                        | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|---------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Cadastro de orçamento                 | Deve cadastrar orçamento com campos obrigatórios e válidos                            | Cadastrar orçamento com dados válidos                               | Orçamento salvo e retornado com `_id` e `protocolo` único                                           |
| Proibição de protocolo duplicado      | Deve lançar erro ao tentar cadastrar/atualizar orçamento com protocolo já existente   | Cadastrar/atualizar orçamento com protocolo já existente            | Deve lançar erro de unicidade                                                                        |
| Orçamento inexistente                 | Deve lançar erro ao tentar atualizar ou deletar orçamento inexistente                 | Atualizar ou deletar orçamento inexistente                          | Deve lançar erro 404                                                                                |
| Manipulação de componentes            | Deve adicionar, atualizar e remover componentes corretamente                          | Adicionar, atualizar, remover componente em orçamento               | Orçamento atualizado corretamente e valor recalculado                                                |
| Falha inesperada do repository        | Deve lançar erro se o repository lançar exceção em qualquer operação                  | Simular erro lançado pelo repository                               | Deve lançar erro e não comprometer a integridade dos dados                                          |

# Plano de Teste Repository (Sprint 7)

| Funcionalidade                        | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|---------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Buscar por nome                       | Deve buscar orçamento por nome corretamente                                           | Buscar orçamento pelo campo `nome`                                 | Retorna o orçamento correto                                                                         |
| Buscar por id                         | Deve buscar orçamento por id corretamente                                             | Buscar orçamento pelo campo `_id`                                  | Retorna o orçamento correto                                                                         |
| Aplicar filtros de busca              | Deve aplicar filtros de busca (nome, protocolo, etc)                                 | Buscar orçamentos com diferentes filtros                           | Retorna apenas os orçamentos que atendem aos filtros                                               |
| Manipulação de componentes            | Deve adicionar, atualizar e remover componentes corretamente                          | Adicionar, atualizar, remover componente em orçamento               | Orçamento atualizado corretamente e valor recalculado                                                |
| Erro para operações inválidas         | Deve retornar erro apropriado para operações inválidas                                | Buscar, atualizar ou deletar orçamento inexistente                  | Deve retornar erro 404 para orçamento não encontrado                                                |
| Buscar por protocolo duplicado        | Deve impedir cadastro de orçamento com protocolo já existente                         | Buscar orçamento por protocolo já cadastrado                       | Retorna erro de unicidade                                                                           |
| Remoção de orçamento inexistente      | Deve lançar erro ao tentar remover orçamento inexistente                              | Tentar deletar orçamento com id inexistente                         | Deve lançar erro 404                                                                                |

# Plano de Teste Endpoints (Sprint 7)

| Funcionalidade                        | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|---------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Listar orçamentos                     | Deve retornar todos os orçamentos via GET /orcamentos                                 | Fazer requisição GET /orcamentos                                   | Resposta contém array com os orçamentos cadastrados                                                |
| Buscar orçamento por id               | Deve retornar o orçamento correto via GET /orcamentos/:id                             | Fazer requisição GET /orcamentos/:id                               | Retorna o orçamento correto ou erro 404 se não encontrado                                         |
| Cadastrar orçamento                   | Deve cadastrar orçamento via POST /orcamentos                                        | Fazer POST /orcamentos com dados válidos                           | Orçamento cadastrado e retornado com _id                                                           |
| Cadastro inválido                     | Não deve cadastrar orçamento com dados inválidos via POST /orcamentos                | Fazer POST /orcamentos sem campos obrigatórios ou protocolo duplicado| Retorna erro 400 conforme o caso                                                                   |
| Atualizar orçamento                   | Deve atualizar orçamento via PUT /orcamentos/:id                                     | Fazer PUT /orcamentos/:id com dados válidos                        | Dados do orçamento alterados corretamente                                                          |
| Remover orçamento                     | Deve remover orçamento via DELETE /orcamentos/:id                                    | Fazer DELETE /orcamentos/:id                                       | Orçamento removido                                                                                 |
| Manipulação de componentes            | Deve adicionar, atualizar e remover componentes via rotas específicas                | POST/PATCH/DELETE em /orcamentos/:orcamentoId/componentes/:id      | Orçamento atualizado corretamente e valor recalculado                                              |
| Manipulação inválida de componentes   | Não deve manipular componente inexistente                                            | Atualizar/remover componente inexistente                            | Retorna erro 404 para componente não encontrado                                                    |
| Filtros de busca                      | Deve aplicar filtros via query params em GET /orcamentos                             | Fazer GET /orcamentos?nome=...                                    | Retorna apenas orçamentos que atendem ao filtro                                                    |
| Erro inesperado                       | Deve retornar erro 500 para falhas inesperadas nas rotas                             | Simular erro inesperado em qualquer rota                          | Retorna erro 500 e mensagem padronizada                                                            |
